import{_ as e,K as t,u as a,L as s,i as n,A as i,M as r,o as l,a as o,b as m,t as d,d as p,e as c,w as u,H as x,r as v,f as h,F as f,s as g,h as _,m as b,C as y,c as w,q as I,N as $,O as S,P as E,g as k,Q as L}from"./index-CSrWMW-P.js";import{_ as R,D as j,a as C}from"./SLStatusLabel-CvQbZ0sr.js";import"./SLLoading-DNmSjfVT.js";const F={class:"w-full h-full py-5"},N={class:"px-6 border-b"},q={class:"experiment-title transition-marging duration-300"},D={class:"flex items-center gap-3"},M={class:"text-2xl items-center gap-1 truncate max-w-sm sm:max-w-lg 2xl:max-w-5xl"},P={class:"font-semibold"},T={class:"flex justify-end grow transition-padding duration-300 ml-1"},A={key:0,class:"experiment-description"},B={class:"experiment-navs"},H=e({__name:"ExperimentLayout",setup(e){const w=t(),I=a(),$=s(),S=n($.experiment),E=()=>{_.delete(`/experiment/${$.id}`).then((({data:e})=>{I.deleteExperiment(e.experiment_id),w.replace("/").then((()=>{b.success("Delete Successfully")}))})).catch((({data:e})=>{b.error(e.message)}))},k=async(e,t)=>{const a=$.id,{data:s}=await _.patch(`/experiment/${a}`,e);s.name=s.name.trim(),$.setExperimentPartial(s),I.setExperimentInfo(a,e),t()},L=[{label:i("experiment.navs.index"),to:`/experiment/${$.id}/index`,icon:"experiment"},{label:i("experiment.navs.chart"),to:`/experiment/${$.id}/chart`,icon:"chart"},{label:i("experiment.navs.log"),to:`/experiment/${$.id}/log`,icon:"logs"},{label:i("experiment.navs.env"),to:`/experiment/${$.id}/env`,icon:"info"}];return(e,t)=>{const a=C,s=y,n=r("RouterLink");return l(),o("div",F,[m("div",N,[m("div",q,[m("div",D,[m("h1",M,[m("span",P,d(p($).name),1)]),c(R,{type:"experiment",onModify:k,disabled:p($).isRunning},null,8,["disabled"]),c(a,{name:S.value.name,status:S.value.status},{default:u((()=>[x(d(e.$t("experiment.status."+S.value.status)),1)])),_:1},8,["name","status"]),p($).isRunning?v(e.$slots,"stop-button",{key:0},void 0,!0):h("",!0)]),m("div",T,[c(j,{type:"experiment",onConfirm:E})])]),p($).description?(l(),o("p",A,d(p($).description),1)):h("",!0),m("nav",B,[(l(),o(f,null,g(L,(e=>c(n,{class:"nav-item","active-class":"nav-active","data-text":e.label,key:e.to,to:e.to},{default:u((()=>[c(s,{icon:e.icon,class:"w-5 h-5"},null,8,["icon"]),x(" "+d(e.label),1)])),_:2},1032,["data-text","to"]))),64))])]),v(e.$slots,"default",{},void 0,!0)])}}},[["__scopeId","data-v-96dd552f"]]),K={__name:"StopButton",setup(e){const t=s(),n=t.id,r=t.status,m=w((()=>0===r)),d=()=>{$(i("experiment.index.header.stop.modal.title"),i("experiment.index.header.stop.modal.text")).then(p)},p=async()=>{const{data:e}=await _.get(`/experiment/${n}/stop`);e&&(t.setStatus(e.status),t.setFinishTime(e.finish_time),a().setExperimentStatus(n,-1,e.finish_time),b.success("State changed"))};return(e,t)=>(l(),o("button",{class:I(["underline text-dimmest ml-2",m.value?"":"cursor-not-allowed"]),onClick:d}," is over? ",2))}},O={__name:"ExperimentView",setup(e){const t=S(),i=s(),m=a(),d=w((()=>void 0!==i.id)),x=n(0),v=async(e=t.params.experimentId)=>{i.experiment=void 0,i.charts=void 0,_.get(`/experiment/${e}`).then((({data:e})=>{i.experiment=e,m.setExperimentStatus(e.id,e.status,e.finish_time),i.isRunning&&b()})).catch((e=>{var t;console.error(e),x.value=(null==(t=e.data)?void 0:t.code)||3e3}))};v(),E(((e,t)=>{e.params.experimentId!==t.params.experimentId&&(v(e.params.experimentId),clearInterval(g))}));let g=null;const b=()=>{g=setInterval((()=>{_.get(`/experiment/${i.id}/status`).then((({data:e})=>Number(i.id)!==Number(t.params.experimentId)?(clearInterval(g),console.log("stop, experiment id is not equal to route id")):(i.setStatus(e.status),i.setFinishTime(e.finish_time),m.setExperimentStatus(i.id,e.status,e.finish_time),i.charts=e.charts,i.isRunning?void 0:(clearInterval(g),console.log("stop, experiment status is not 0"))))).catch((e=>{console.error("polling error",e),clearInterval(g)}))}),1e3)};return(e,t)=>{const a=r("router-view");return l(),o(f,null,[d.value?(l(),k(H,{key:p(i).id},{"stop-button":u((()=>[c(K)])),default:u((()=>[c(a)])),_:1})):h("",!0),!d.value&&x.value?(l(),k(L,{key:1,code:x.value},null,8,["code"])):h("",!0)],64)}}};export{O as default};
